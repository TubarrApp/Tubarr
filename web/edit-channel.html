<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Edit Channel | Tubarr</title>
    <link rel="icon" href="/favicon.ico">
    <link href="style.css" rel="stylesheet">
  </head>
  <body
    x-data="{ page: 'editChannel', 'loaded': true, 'stickyMenu': false, 'sidebarToggle': false, 'scrollTop': false }"
    class="dark bg-gray-900"
  >
    <!-- ===== Preloader Start ===== -->
    <div
      x-show="loaded"
      x-init="window.addEventListener('DOMContentLoaded', () => {setTimeout(() => loaded = false, 500)})"
      class="fixed left-0 top-0 z-999999 flex h-screen w-screen items-center justify-center bg-white dark:bg-black"
    >
      <div
        class="h-16 w-16 animate-spin rounded-full border-4 border-solid border-brand-500 border-t-transparent"
      ></div>
    </div>
    <!-- ===== Preloader End ===== -->

    <!-- ===== Page Wrapper Start ===== -->
    <div class="flex h-screen overflow-hidden">
      <!-- ===== Sidebar Start ===== -->
      <aside
        :class="sidebarToggle ? 'translate-x-0 xl:w-[90px]' : '-translate-x-full'"
        class="sidebar fixed top-0 left-0 z-9999 flex h-screen w-[290px] flex-col overflow-y-auto border-r border-gray-200 bg-white px-5 transition-all duration-300 xl:static xl:translate-x-0 dark:border-gray-800 dark:bg-black"
        @click.outside="sidebarToggle = false"
      >
        <!-- SIDEBAR HEADER -->
        <div
          :class="sidebarToggle ? 'justify-center' : 'justify-between'"
          class="sidebar-header flex items-center gap-2 pt-8 pb-7"
        >
          <a href="index.html">
            <span class="logo" :class="sidebarToggle ? 'hidden' : ''">
              <img src="/src/images/logo/logo-dark.svg" alt="Logo" />
            </span>

            <img
              class="logo-icon"
              :class="sidebarToggle ? 'xl:block' : 'hidden'"
              src="/src/images/logo/logo-icon.svg"
              alt="Logo"
            />
          </a>
        </div>
        <!-- SIDEBAR HEADER -->

        <div
          class="no-scrollbar flex flex-col overflow-y-auto duration-300 ease-linear"
        >
          <!-- Sidebar Menu -->
          <nav x-data="{selected: $persist('Channels')}">
            <!-- Menu Group -->
            <div>
              <h3 class="mb-4 text-xs leading-[20px] text-gray-400 uppercase">
                <span
                  class="menu-group-title"
                  :class="sidebarToggle ? 'xl:hidden' : ''"
                >
                  MENU
                </span>

                <svg
                  :class="sidebarToggle ? 'xl:block hidden' : 'hidden'"
                  class="menu-group-icon mx-auto fill-current"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M5.99915 10.2451C6.96564 10.2451 7.74915 11.0286 7.74915 11.9951V12.0051C7.74915 12.9716 6.96564 13.7551 5.99915 13.7551C5.03265 13.7551 4.24915 12.9716 4.24915 12.0051V11.9951C4.24915 11.0286 5.03265 10.2451 5.99915 10.2451ZM17.9991 10.2451C18.9656 10.2451 19.7491 11.0286 19.7491 11.9951V12.0051C19.7491 12.9716 18.9656 13.7551 17.9991 13.7551C17.0326 13.7551 16.2491 12.9716 16.2491 12.0051V11.9951C16.2491 11.0286 17.0326 10.2451 17.9991 10.2451ZM13.7491 11.9951C13.7491 11.0286 12.9656 10.2451 11.9991 10.2451C11.0326 10.2451 10.2491 11.0286 10.2491 11.9951V12.0051C10.2491 12.9716 11.0326 13.7551 11.9991 13.7551C12.9656 13.7551 13.7491 12.9716 13.7491 12.0051V11.9951Z"
                    fill="currentColor"
                  />
                </svg>
              </h3>

              <ul class="mb-6 flex flex-col gap-1">
                <!-- Menu Item Home -->
                <li>
                  <a
                    href="index.html"
                    @click="selected = 'Home'"
                    class="menu-item group"
                    :class="(selected === 'Home') || (page === 'home') ? 'menu-item-active' : 'menu-item-inactive'"
                  >
                    <svg
                      :class="(selected === 'Home') || (page === 'home') ? 'menu-item-icon-active'  :'menu-item-icon-inactive'"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M5.5 3.25C4.25736 3.25 3.25 4.25736 3.25 5.5V8.99998C3.25 10.2426 4.25736 11.25 5.5 11.25H9C10.2426 11.25 11.25 10.2426 11.25 8.99998V5.5C11.25 4.25736 10.2426 3.25 9 3.25H5.5ZM4.75 5.5C4.75 5.08579 5.08579 4.75 5.5 4.75H9C9.41421 4.75 9.75 5.08579 9.75 5.5V8.99998C9.75 9.41419 9.41421 9.74998 9 9.74998H5.5C5.08579 9.74998 4.75 9.41419 4.75 8.99998V5.5ZM5.5 12.75C4.25736 12.75 3.25 13.7574 3.25 15V18.5C3.25 19.7426 4.25736 20.75 5.5 20.75H9C10.2426 20.75 11.25 19.7427 11.25 18.5V15C11.25 13.7574 10.2426 12.75 9 12.75H5.5ZM4.75 15C4.75 14.5858 5.08579 14.25 5.5 14.25H9C9.41421 14.25 9.75 14.5858 9.75 15V18.5C9.75 18.9142 9.41421 19.25 9 19.25H5.5C5.08579 19.25 4.75 18.9142 4.75 18.5V15ZM12.75 5.5C12.75 4.25736 13.7574 3.25 15 3.25H18.5C19.7426 3.25 20.75 4.25736 20.75 5.5V8.99998C20.75 10.2426 19.7426 11.25 18.5 11.25H15C13.7574 11.25 12.75 10.2426 12.75 8.99998V5.5ZM15 4.75C14.5858 4.75 14.25 5.08579 14.25 5.5V8.99998C14.25 9.41419 14.5858 9.74998 15 9.74998H18.5C18.9142 9.74998 19.25 9.41419 19.25 8.99998V5.5C19.25 5.08579 18.9142 4.75 18.5 4.75H15ZM15 12.75C13.7574 12.75 12.75 13.7574 12.75 15V18.5C12.75 19.7426 13.7574 20.75 15 20.75H18.5C19.7426 20.75 20.75 19.7427 20.75 18.5V15C20.75 13.7574 19.7426 12.75 18.5 12.75H15ZM14.25 15C14.25 14.5858 14.5858 14.25 15 14.25H18.5C18.9142 14.25 19.25 14.5858 19.25 15V18.5C19.25 18.9142 18.9142 19.25 18.5 19.25H15C14.5858 19.25 14.25 18.9142 14.25 18.5V15Z"
                        fill="currentColor"
                      />
                    </svg>

                    <span
                      class="menu-item-text"
                      :class="sidebarToggle ? 'xl:hidden' : ''"
                    >
                      Home
                    </span>
                  </a>
                </li>
                <!-- Menu Item Home -->

                <!-- Menu Item Channels -->
                <li>
                  <a
                    href="#"
                    @click.prevent="selected = (selected === 'Channels' ? '':'Channels')"
                    class="menu-item group"
                    :class=" (selected === 'Channels') || (page === 'addChannel' || page === 'editChannel' || page === 'listChannels') ? 'menu-item-active' : 'menu-item-inactive'"
                  >
                    <svg
                      :class="(selected === 'Channels') || (page === 'addChannel' || page === 'editChannel' || page === 'listChannels') ? 'menu-item-icon-active'  :'menu-item-icon-inactive'"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M3.25 5.5C3.25 4.25736 4.25736 3.25 5.5 3.25H18.5C19.7426 3.25 20.75 4.25736 20.75 5.5V18.5C20.75 19.7426 19.7426 20.75 18.5 20.75H5.5C4.25736 20.75 3.25 19.7426 3.25 18.5V5.5ZM5.5 4.75C5.08579 4.75 4.75 5.08579 4.75 5.5V8.58325L19.25 8.58325V5.5C19.25 5.08579 18.9142 4.75 18.5 4.75H5.5ZM19.25 10.0833H15.416V13.9165H19.25V10.0833ZM13.916 10.0833L10.083 10.0833V13.9165L13.916 13.9165V10.0833ZM8.58301 10.0833H4.75V13.9165H8.58301V10.0833ZM4.75 18.5V15.4165H8.58301V19.25H5.5C5.08579 19.25 4.75 18.9142 4.75 18.5ZM10.083 19.25V15.4165L13.916 15.4165V19.25H10.083ZM15.416 19.25V15.4165H19.25V18.5C19.25 18.9142 18.9142 19.25 18.5 19.25H15.416Z"
                        fill="currentColor"
                      />
                    </svg>

                    <span
                      class="menu-item-text"
                      :class="sidebarToggle ? 'xl:hidden' : ''"
                    >
                      Channels
                    </span>

                    <svg
                      class="menu-item-arrow"
                      :class="[(selected === 'Channels') ? 'menu-item-arrow-active' : 'menu-item-arrow-inactive', sidebarToggle ? 'xl:hidden' : '' ]"
                      width="20"
                      height="20"
                      viewBox="0 0 20 20"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M4.79175 7.39584L10.0001 12.6042L15.2084 7.39585"
                        stroke="currentColor"
                        stroke-width="1.5"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </a>

                  <!-- Dropdown Menu Start -->
                  <div
                    class="translate transform overflow-hidden"
                    :class="(selected === 'Channels') ? 'block' :'hidden'"
                  >
                    <ul
                      :class="sidebarToggle ? 'xl:hidden' : 'flex'"
                      class="menu-dropdown mt-2 flex flex-col gap-1 pl-9"
                    >
                      <li>
                        <a
                          href="add-channel.html"
                          class="menu-dropdown-item group"
                          :class="page === 'addChannel' ? 'menu-dropdown-item-active' : 'menu-dropdown-item-inactive'"
                        >
                          Add Channel
                        </a>
                      </li>
                      <li>
                        <a
                          href="add-channel-from-files.html"
                          class="menu-dropdown-item group"
                          :class="page === 'addChannelFromFile' ? 'menu-dropdown-item-active' : 'menu-dropdown-item-inactive'"
                        >
                          Add from Files
                        </a>
                      </li>
                      <li>
                        <a
                          href="list-channels.html"
                          class="menu-dropdown-item group"
                          :class="page === 'listChannels' ? 'menu-dropdown-item-active' : 'menu-dropdown-item-inactive'"
                        >
                          List Channels
                        </a>
                      </li>
                    </ul>
                  </div>
                  <!-- Dropdown Menu End -->
                </li>
                <!-- Menu Item Channels -->
              </ul>
            </div>
          </nav>
          <!-- Sidebar Menu -->
        </div>
      </aside>
      <!-- ===== Sidebar End ===== -->

      <!-- ===== Content Area Start ===== -->
      <div
        class="relative flex flex-col flex-1 overflow-x-hidden overflow-y-auto"
      >
        <!-- Small Device Overlay Start -->
        <div
          :class="sidebarToggle ? 'block xl:hidden' : 'hidden'"
          class="fixed z-50 h-screen w-full bg-gray-900/50"
        ></div>
        <!-- Small Device Overlay End -->

        <!-- ===== Header Start ===== -->
        <header
          x-data="{menuToggle: false}"
          class="sticky top-0 z-99999 flex w-full border-gray-200 bg-white xl:border-b dark:border-gray-800 dark:bg-gray-900"
        >
          <div
            class="flex grow flex-col items-center justify-between xl:flex-row xl:px-6"
          >
            <div
              class="flex w-full items-center justify-between gap-2 border-b border-gray-200 px-3 py-3 sm:gap-4 lg:py-4 xl:justify-normal xl:border-b-0 xl:px-0 dark:border-gray-800"
            >
              <!-- Hamburger Toggle BTN -->
              <button
                :class="sidebarToggle ? 'xl:bg-transparent dark:xl:bg-transparent bg-gray-100 dark:bg-gray-800' : ''"
                class="z-99999 flex h-10 w-10 items-center justify-center rounded-lg border-gray-200 text-gray-500 xl:h-11 xl:w-11 xl:border dark:border-gray-800 dark:text-gray-400"
                @click.stop="sidebarToggle = !sidebarToggle"
              >
                <svg
                  class="hidden fill-current xl:block"
                  width="16"
                  height="12"
                  viewBox="0 0 16 12"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M0.583252 1C0.583252 0.585788 0.919038 0.25 1.33325 0.25H14.6666C15.0808 0.25 15.4166 0.585786 15.4166 1C15.4166 1.41421 15.0808 1.75 14.6666 1.75L1.33325 1.75C0.919038 1.75 0.583252 1.41422 0.583252 1ZM0.583252 11C0.583252 10.5858 0.919038 10.25 1.33325 10.25L14.6666 10.25C15.0808 10.25 15.4166 10.5858 15.4166 11C15.4166 11.4142 15.0808 11.75 14.6666 11.75L1.33325 11.75C0.919038 11.75 0.583252 11.4142 0.583252 11ZM1.33325 5.25C0.919038 5.25 0.583252 5.58579 0.583252 6C0.583252 6.41421 0.919038 6.75 1.33325 6.75L7.99992 6.75C8.41413 6.75 8.74992 6.41421 8.74992 6C8.74992 5.58579 8.41413 5.25 7.99992 5.25L1.33325 5.25Z"
                    fill=""
                  />
                </svg>

                <svg
                  :class="sidebarToggle ? 'hidden' : 'block xl:hidden'"
                  class="fill-current xl:hidden"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M3.25 6C3.25 5.58579 3.58579 5.25 4 5.25L20 5.25C20.4142 5.25 20.75 5.58579 20.75 6C20.75 6.41421 20.4142 6.75 20 6.75L4 6.75C3.58579 6.75 3.25 6.41422 3.25 6ZM3.25 18C3.25 17.5858 3.58579 17.25 4 17.25L20 17.25C20.4142 17.25 20.75 17.5858 20.75 18C20.75 18.4142 20.4142 18.75 20 18.75L4 18.75C3.58579 18.75 3.25 18.4142 3.25 18ZM4 11.25C3.58579 11.25 3.25 11.5858 3.25 12C3.25 12.4142 3.58579 12.75 4 12.75L12 12.75C12.4142 12.75 12.75 12.4142 12.75 12C12.75 11.5858 12.4142 11.25 12 11.25L4 11.25Z"
                    fill=""
                  />
                </svg>

                <!-- cross icon -->
                <svg
                  :class="sidebarToggle ? 'block xl:hidden' : 'hidden'"
                  class="fill-current"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M6.21967 7.28131C5.92678 6.98841 5.92678 6.51354 6.21967 6.22065C6.51256 5.92775 6.98744 5.92775 7.28033 6.22065L11.999 10.9393L16.7176 6.22078C17.0105 5.92789 17.4854 5.92788 17.7782 6.22078C18.0711 6.51367 18.0711 6.98855 17.7782 7.28144L13.0597 12L17.7782 16.7186C18.0711 17.0115 18.0711 17.4863 17.7782 17.7792C17.4854 18.0721 17.0105 18.0721 16.7176 17.7792L11.999 13.0607L7.28033 17.7794C6.98744 18.0722 6.51256 18.0722 6.21967 17.7794C5.92678 17.4865 5.92678 17.0116 6.21967 16.7187L10.9384 12L6.21967 7.28131Z"
                    fill=""
                  />
                </svg>
              </button>
              <!-- Hamburger Toggle BTN -->

              <a href="index.html" class="xl:hidden">
                <img class="dark:hidden" src="/src/images/logo/logo.svg" alt="Logo" />
                <img
                  class="hidden dark:block"
                  src="/src/images/logo/logo-dark.svg"
                  alt="Logo"
                />
              </a>

              <div class="hidden xl:block">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-white/90">
                  Add Channel
                </h2>
              </div>
            </div>

            <div
              class="shadow-theme-md w-full items-center justify-between gap-4 px-5 py-4 xl:flex xl:justify-end xl:px-0 xl:shadow-none"
            >
              <div class="2xsm:gap-3 flex items-center gap-2">
                
                <!-- Dark Mode Toggler -->
              </div>
            </div>
          </div>
        </header>
        <!-- ===== Header End ===== -->

        <!-- ===== Main Content Start ===== -->
        <main>
          <div class="p-4 mx-auto max-w-(--breakpoint-2xl) md:p-6">
            <!-- Breadcrumb Start -->
            <div x-data="{ pageName: `Edit Channel`}">
              <div class="flex flex-wrap items-center justify-between gap-3 pb-6">
                <h2
                  class="text-xl font-semibold text-gray-800 dark:text-white/90"
                  x-text="pageName"
                ></h2>
                <nav>
                  <ol class="flex items-center gap-1.5">
                    <li>
                      <a
                        class="inline-flex items-center gap-1.5 text-sm text-gray-500 dark:text-gray-400"
                        href="index.html"
                      >
                        Home
                      </a>
                    </li>
                    <li>
                      <span class="text-sm text-gray-500 dark:text-gray-400">/</span>
                    </li>
                    <li>
                      <span class="text-sm text-gray-500 dark:text-gray-400">Edit Channel</span>
                    </li>
                  </ol>
                </nav>
              </div>
            </div>
            <!-- Breadcrumb End -->

            <!-- Form Start -->
            <div
              x-data="channelForm()" x-init="init()"
              class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"
            >
              <div class="px-5 py-4 sm:px-6 sm:py-5 border-b border-gray-200 dark:border-gray-800">
                <h3 class="text-base font-medium text-gray-800 dark:text-white/90">
                  Edit Channel
                </h3>
                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
                  Update your channel settings, URLs, and processing options.
                </p>
              </div>

              <form @submit.prevent="submitForm" class="p-5 sm:p-6 space-y-6">
                <!-- Error Display -->
                <div x-show="error" x-text="error" class="p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg dark:bg-red-900/20 dark:border-red-800 dark:text-red-400"></div>

                <!-- Success Display -->
                <div x-show="success" x-text="success" class="p-4 bg-green-50 border border-green-200 text-green-700 rounded-lg dark:bg-green-900/20 dark:border-green-800 dark:text-green-400"></div>
                <!-- Loading Display -->
                <div x-show="loading" class="p-8 text-center">
                  <div class="inline-block h-12 w-12 animate-spin rounded-full border-4 border-solid border-brand-500 border-t-transparent"></div>
                  <p class="mt-4 text-sm text-gray-500 dark:text-gray-400">Loading channel data...</p>
                </div>


                <!-- Form Content (hidden while loading) -->
                <div x-show="!loading">
                <!-- Basic Info -->
                <div class="space-y-4">
                  <h4 class="text-sm font-semibold text-gray-800 dark:text-white/90">Basic Information</h4>

                  <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                      Channel Name <span class="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      x-model="formData.name"
                      required
                      placeholder="My Channel"
                      class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                    />
                  </div>
                </div>

                <!-- Channel URLs -->
                <div class="space-y-4 mt-6">
                  <div class="flex items-center justify-between">
                    <h4 class="text-sm font-semibold text-gray-800 dark:text-white/90">Channel URLs</h4>
                    <button
                      type="button"
                      @click="addURL"
                      class="inline-flex items-center px-3 py-2 text-sm font-medium text-white bg-brand-500 rounded-lg hover:bg-brand-600 focus:ring-3 focus:ring-brand-500/50"
                    >
                      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                      </svg>
                      Add URL
                    </button>
                  </div>

                  <template x-for="(urlEntry, index) in formData.urls" :key="index">
                    <div class="p-4 border border-gray-200 rounded-lg dark:border-gray-700 space-y-4">
                      <div class="flex items-center justify-between">
                        <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300" x-text="'URL ' + (index + 1)"></h5>
                        <button
                          type="button"
                          @click="removeURL(index)"
                          x-show="formData.urls.length > 1"
                          class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm"
                        >
                          Remove
                        </button>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          URL <span class="text-red-500">*</span>
                        </label>
                        <input
                          type="url"
                          x-model="urlEntry.url"
                          required
                          placeholder="https://example.com/channel"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <!-- Auth Details Toggle -->
                      <div>
                        <label class="flex items-center cursor-pointer">
                          <input
                            type="checkbox"
                            x-model="urlEntry.hasAuth"
                            class="mr-2 rounded border-gray-300 text-brand-500 focus:ring-brand-500"
                          />
                          <span class="text-sm text-gray-700 dark:text-gray-300">Requires Authentication</span>
                        </label>
                      </div>

                      <!-- Auth Fields (shown when hasAuth is true) -->
                      <div x-show="urlEntry.hasAuth" class="space-y-3 pl-6 border-l-2 border-brand-500">
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Username
                          </label>
                          <input
                            type="text"
                            x-model="urlEntry.username"
                            placeholder="username"
                            class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                          />
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Password
                          </label>
                          <input
                            type="password"
                            x-model="urlEntry.password"
                            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                            class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                          />
                        </div>
                        <div>
                          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Login URL
                          </label>
                          <input
                            type="url"
                            x-model="urlEntry.loginURL"
                            placeholder="https://example.com/login"
                            class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                          />
                        </div>
                      </div>

                      <!-- Per-URL Settings Toggle -->
                      <div>
                        <label class="flex items-center cursor-pointer">
                          <input
                            type="checkbox"
                            x-model="urlEntry.hasCustomSettings"
                            class="mr-2 rounded border-gray-300 text-brand-500 focus:ring-brand-500"
                          />
                          <span class="text-sm text-gray-700 dark:text-gray-300">Custom Settings for this URL</span>
                        </label>
                      </div>

                      <!-- Custom Settings (shown when hasCustomSettings is true) -->
                      <div x-show="urlEntry.hasCustomSettings" x-data="{ urlTab: 'overview' }" class="mt-4 p-4 border-2 border-brand-500 dark:border-brand-600 rounded-lg space-y-3 bg-blue-50 dark:bg-blue-900/20">
                        <div class="flex items-center justify-between">
                          <p class="text-sm font-semibold text-gray-700 dark:text-gray-300">ðŸ”§ Per-URL Override Settings</p>
                          <p class="text-xs text-gray-600 dark:text-gray-400">(Leave empty to use global)</p>
                        </div>

                        <!-- Per-URL Tabs -->
                        <div class="border-b border-gray-300 dark:border-gray-600">
                          <nav class="flex flex-wrap gap-1">
                            <button type="button" @click="urlTab = 'overview'" :class="urlTab === 'overview' ? 'border-brand-500 text-brand-600 dark:text-brand-400 bg-white dark:bg-gray-800' : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'" class="py-1 px-2 border-b-2 text-xs font-medium rounded-t">Overview</button>
                            <button type="button" @click="urlTab = 'basic'" :class="urlTab === 'basic' ? 'border-brand-500 text-brand-600 dark:text-brand-400 bg-white dark:bg-gray-800' : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'" class="py-1 px-2 border-b-2 text-xs">Basic</button>
                            <button type="button" @click="urlTab = 'advanced'" :class="urlTab === 'advanced' ? 'border-brand-500 text-brand-600 dark:text-brand-400 bg-white dark:bg-gray-800' : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'" class="py-1 px-2 border-b-2 text-xs">Advanced</button>
                            <button type="button" @click="urlTab = 'metarr'" :class="urlTab === 'metarr' ? 'border-brand-500 text-brand-600 dark:text-brand-400 bg-white dark:bg-gray-800' : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'" class="py-1 px-2 border-b-2 text-xs">Metarr</button>
                          </nav>
                        </div>

                        <!-- Overview Tab -->
                        <div x-show="urlTab === 'overview'" class="text-xs text-gray-700 dark:text-gray-300 space-y-2">
                          <p class="font-medium">This URL can override ANY global channel setting.</p>
                          <ul class="list-disc list-inside space-y-1 ml-2">
                            <li><strong>Basic:</strong> Directories, concurrency, retries, filesize, filters</li>
                            <li><strong>Advanced:</strong> YT-DLP settings, external downloaders, move operations</li>
                            <li><strong>Metarr:</strong> Output directory, transcoding, meta/filename operations</li>
                          </ul>
                          <p class="mt-2 text-brand-600 dark:text-brand-400">ðŸ’¡ Any field left empty will use the global channel setting.</p>
                        </div>

                        <!-- Basic Tab for This URL -->
                        <div x-show="urlTab === 'basic'" class="space-y-2">
                          <div class="grid grid-cols-2 gap-2">
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Video Directory</label>
                              <input type="text" x-model="urlEntry.custom.video_directory" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">JSON Directory</label>
                              <input type="text" x-model="urlEntry.custom.json_directory" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Max Concurrency</label>
                              <input type="number" x-model.number="urlEntry.custom.max_concurrency" placeholder="Global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Crawl Frequency (min)</label>
                              <input type="number" x-model.number="urlEntry.custom.crawl_freq" placeholder="Global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Download Retries</label>
                              <input type="number" x-model.number="urlEntry.custom.download_retries" placeholder="Global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Max Filesize</label>
                              <input type="text" x-model="urlEntry.custom.max_filesize" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">From Date</label>
                              <input type="text" x-model="urlEntry.custom.from_date" placeholder="YYYYMMDD" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">To Date</label>
                              <input type="text" x-model="urlEntry.custom.to_date" placeholder="YYYYMMDD" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div class="col-span-2">
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Channel Config File</label>
                              <input type="text" x-model="urlEntry.custom.channel_config_file" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div class="col-span-2">
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Filter File</label>
                              <input type="text" x-model="urlEntry.custom.filter_file" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                          </div>
                          <div>
                            <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Filters (one per line)</label>
                            <textarea x-model="urlEntry.custom.filters" rows="3" placeholder="title:contains:keyword:must" class="w-full rounded border px-2 py-1 text-xs font-mono dark:bg-gray-900 dark:border-gray-600 dark:text-gray-300"></textarea>
                          </div>
                        </div>

                        <!-- Advanced Tab for This URL -->
                        <div x-show="urlTab === 'advanced'" class="space-y-2">
                          <div class="grid grid-cols-2 gap-2">
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">YT-DLP Output Ext</label>
                              <select x-model="urlEntry.custom.ytdlp_output_ext" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90">
                                <option value="">Use global</option>
                                <option value="mp4">mp4</option>
                                <option value="mkv">mkv</option>
                                <option value="webm">webm</option>
                                <option value="avi">avi</option>
                                <option value="flv">flv</option>
                                <option value="mov">mov</option>
                              </select>
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Cookies From Browser</label>
                              <input type="text" x-model="urlEntry.custom.cookies_from_browser" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">External Downloader</label>
                              <input type="text" x-model="urlEntry.custom.external_downloader" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">External Downloader Args</label>
                              <input type="text" x-model="urlEntry.custom.external_downloader_args" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                          </div>
                          <div>
                            <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Extra YT-DLP Video Args</label>
                            <input type="text" x-model="urlEntry.custom.extra_ytdlp_video_args" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                          </div>
                          <div>
                            <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Extra YT-DLP Meta Args</label>
                            <input type="text" x-model="urlEntry.custom.extra_ytdlp_meta_args" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                          </div>
                          <div>
                            <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Move Operations File</label>
                            <input type="text" x-model="urlEntry.custom.move_ops_file" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                          </div>
                          <div>
                            <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Move Operations (one per line)</label>
                            <textarea x-model="urlEntry.custom.move_ops" rows="2" placeholder="title:keyword:/path" class="w-full rounded border px-2 py-1 text-xs font-mono dark:bg-gray-900 dark:border-gray-600 dark:text-gray-300"></textarea>
                          </div>
                        </div>

                        <!-- Metarr Tab for This URL -->
                        <div x-show="urlTab === 'metarr'" class="space-y-2">
                          <div class="grid grid-cols-2 gap-2">
                            <div class="col-span-2">
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Output Directory</label>
                              <input type="text" x-model="urlEntry.custom.metarr_output_directory" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Output Extension</label>
                              <select x-model="urlEntry.custom.metarr_output_ext" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90">
                                <option value="">Use global</option>
                                <option value="avi">avi</option>
                                <option value="flv">flv</option>
                                <option value="mkv">mkv</option>
                                <option value="mov">mov</option>
                                <option value="mp4">mp4</option>
                                <option value="webm">webm</option>
                              </select>
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Rename Style</label>
                              <select x-model="urlEntry.custom.metarr_rename_style" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90">
                                <option value="">Use global</option>
                                <option value="spaces">Spaces</option>
                                <option value="underscores">Underscores</option>
                                <option value="fixes-only">Fixes Only</option>
                              </select>
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Concurrency</label>
                              <input type="number" x-model.number="urlEntry.custom.metarr_concurrency" placeholder="Global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Max CPU Usage (%)</label>
                              <input type="number" x-model.number="urlEntry.custom.metarr_max_cpu_usage" placeholder="Global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Min Free Memory</label>
                              <input type="text" x-model="urlEntry.custom.metarr_min_free_mem" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">GPU</label>
                              <input type="text" x-model="urlEntry.custom.metarr_gpu" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Video Transcode Codecs</label>
                              <textarea
                                x-model="urlEntry.custom.metarr_video_transcode_codecs"
                                placeholder="Use global (one per line, e.g. h264:hevc or av1)"
                                rows="2"
                                class="w-full rounded border px-2 py-1 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90 font-mono"
                              ></textarea>
                              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">One per line. Format: codec or source:target (e.g., h264:hevc)</p>
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Audio Transcode Codecs</label>
                              <textarea
                                x-model="urlEntry.custom.metarr_transcode_audio_codecs"
                                placeholder="Use global (one per line, e.g. aac or dts:ac3)"
                                rows="2"
                                class="w-full rounded border px-2 py-1 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90 font-mono"
                              ></textarea>
                              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">One per line. Format: codec or source:target (e.g., dts:ac3)</p>
                            </div>
                            <div>
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Transcode Quality (CRF)</label>
                              <input type="number" x-model.number="urlEntry.custom.metarr_transcode_quality" placeholder="Global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div class="col-span-2">
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Transcode Video Filter</label>
                              <input type="text" x-model="urlEntry.custom.metarr_transcode_video_filter" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                            <div class="col-span-2">
                              <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Extra FFmpeg Args</label>
                              <input type="text" x-model="urlEntry.custom.metarr_extra_ffmpeg_args" placeholder="Use global" class="w-full h-8 rounded border px-2 text-xs dark:bg-gray-900 dark:border-gray-600 dark:text-white/90" />
                            </div>
                          </div>
                          <div>
                            <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Meta Operations (one per line)</label>
                            <textarea x-model="urlEntry.custom.metarr_meta_ops" rows="2" placeholder="artist:set:Value" class="w-full rounded border px-2 py-1 text-xs font-mono dark:bg-gray-900 dark:border-gray-600 dark:text-gray-300"></textarea>
                          </div>
                          <div>
                            <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Filename Operations (one per line)</label>
                            <textarea x-model="urlEntry.custom.metarr_filename_ops" rows="2" placeholder="prefix:[PREFIX] " class="w-full rounded border px-2 py-1 text-xs font-mono dark:bg-gray-900 dark:border-gray-600 dark:text-gray-300"></textarea>
                          </div>
                          <div>
                            <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Filtered Meta Operations (one per line)</label>
                            <textarea x-model="urlEntry.custom.filtered_meta_ops" rows="2" placeholder="filter_rule|meta_op" class="w-full rounded border px-2 py-1 text-xs font-mono dark:bg-gray-900 dark:border-gray-600 dark:text-gray-300"></textarea>
                          </div>
                          <div>
                            <label class="block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300">Filtered Filename Operations (one per line)</label>
                            <textarea x-model="urlEntry.custom.filtered_filename_ops" rows="2" placeholder="filter_rule|filename_op" class="w-full rounded border px-2 py-1 text-xs font-mono dark:bg-gray-900 dark:border-gray-600 dark:text-gray-300"></textarea>
                          </div>
                        </div>

                      </div>
                    </div>
                  </template>
                </div>

                <!-- Tabs for Settings -->
                <div x-data="{ activeTab: 'basic' }" class="space-y-4">
                  <div class="border-b border-gray-200 dark:border-gray-700">
                    <nav class="flex space-x-4">
                      <button
                        type="button"
                        @click="activeTab = 'basic'"
                        :class="activeTab === 'basic' ? 'border-brand-500 text-brand-600 dark:text-brand-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400'"
                        class="py-2 px-4 border-b-2 font-medium text-sm"
                      >
                        Basic Settings
                      </button>
                      <button
                        type="button"
                        @click="activeTab = 'advanced'"
                        :class="activeTab === 'advanced' ? 'border-brand-500 text-brand-600 dark:text-brand-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400'"
                        class="py-2 px-4 border-b-2 font-medium text-sm"
                      >
                        Advanced Settings
                      </button>
                      <button
                        type="button"
                        @click="activeTab = 'metarr'"
                        :class="activeTab === 'metarr' ? 'border-brand-500 text-brand-600 dark:text-brand-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400'"
                        class="py-2 px-4 border-b-2 font-medium text-sm"
                      >
                        Metarr Settings
                      </button>
                      <button
                        type="button"
                        @click="activeTab = 'notifications'"
                        :class="activeTab === 'notifications' ? 'border-brand-500 text-brand-600 dark:text-brand-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400'"
                        class="py-2 px-4 border-b-2 font-medium text-sm"
                      >
                        Notifications
                      </button>
                    </nav>
                  </div>

                  <!-- Basic Settings Tab -->
                  <div x-show="activeTab === 'basic'" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Video Directory <span class="text-red-500">*</span>
                        </label>
                        <input
                          type="text"
                          x-model="formData.settings.video_directory"
                          required
                          placeholder="/path/to/save/videos"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          JSON Directory <span class="text-red-500">*</span>
                        </label>
                        <input
                          type="text"
                          x-model="formData.settings.json_directory"
                          required
                          placeholder="/path/to/save/metadata"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Max Concurrency
                        </label>
                        <input
                          type="number"
                          x-model.number="formData.settings.max_concurrency"
                          min="1"
                          placeholder="3"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">WARNING: Higher concurrency can cause bot detection on some tube sites.</p>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Crawl Frequency (minutes)
                        </label>
                        <input
                          type="number"
                          x-model.number="formData.settings.crawl_freq"
                          min="1"
                          placeholder="30"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">WARNING: Higher frequency increases request rate to site.</p>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Download Retries
                        </label>
                        <input
                          type="number"
                          x-model.number="formData.settings.download_retries"
                          min="0"
                          placeholder="3"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Max Filesize
                        </label>
                        <input
                          type="text"
                          x-model="formData.settings.max_filesize"
                          placeholder="2GB"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Example: 100MB, 2GB, 500M</p>
                      </div>
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Channel Config File
                        </label>
                        <input
                          type="text"
                          x-model="formData.settings.channel_config_file"
                          placeholder="/path/to/config.yaml"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Path to external channel configuration file</p>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          From Date
                        </label>
                        <input
                          type="text"
                          x-model="formData.settings.from_date"
                          placeholder="20240101 or 2024y1m1d or today"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Only download videos uploaded after this date (YYYYMMDD format)</p>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          To Date
                        </label>
                        <input
                          type="text"
                          x-model="formData.settings.to_date"
                          placeholder="20241231 or 2024y12m31d or today"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Only download videos uploaded before this date (YYYYMMDD format)</p>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Filter File
                        </label>
                        <input
                          type="text"
                          x-model="formData.settings.filter_file"
                          placeholder="/path/to/filters.txt"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Path to file containing filter operations (one per line)</p>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Filters
                        </label>
                        <textarea
                          x-model="formData.settings.filters"
                          rows="4"
                          placeholder="title:contains:cat:must&#10;title:omits:dog:any&#10;date:omits::must"
                          class="w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        ></textarea>
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                          Filter operations (one per line). Format: <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">field:contains|omits:value:must|any</code><br>
                          Example: <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">title:contains:tutorial:must</code> (only videos with "tutorial" in title)
                        </p>
                      </div>

                      <div>
                        <label class="flex items-center cursor-pointer">
                          <input
                            type="checkbox"
                            x-model="formData.ignore_run"
                            class="mr-2 rounded border-gray-300 text-brand-500 focus:ring-brand-500"
                          />
                          <span class="text-sm text-gray-700 dark:text-gray-300">Ignore All Videos to Date</span>
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- Advanced Settings Tab -->
                  <div x-show="activeTab === 'advanced'" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          YT-DLP Output Extension
                        </label>
                        <select
                          x-model="formData.settings.ytdlp_output_ext"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
                        >
                          <option value="">Default</option>
                          <option value="mp4">mp4</option>
                          <option value="mkv">mkv</option>
                          <option value="webm">webm</option>
                          <option value="avi">avi</option>
                          <option value="flv">flv</option>
                          <option value="mov">mov</option>
                        </select>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Cookies From Browser
                        </label>
                        <input
                          type="text"
                          x-model="formData.settings.cookies_from_browser"
                          placeholder="e.g. Firefox"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          External Downloader
                        </label>
                        <input
                          type="text"
                          x-model="formData.settings.external_downloader"
                          placeholder="e.g. aria2c"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          External Downloader Args
                        </label>
                        <input
                          type="text"
                          x-model="formData.settings.external_downloader_args"
                          placeholder="Additional arguments (e.g. '-x 16 -s 16' for aria2c)"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Extra YT-DLP Video Args
                        </label>
                        <input
                          type="text"
                          x-model="formData.settings.extra_ytdlp_video_args"
                          placeholder="Additional yt-dlp arguments for video downloads"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Extra YT-DLP Meta Args
                        </label>
                        <input
                          type="text"
                          x-model="formData.settings.extra_ytdlp_meta_args"
                          placeholder="Additional yt-dlp arguments for JSON metafile downloads"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Move Operations File
                        </label>
                        <input
                          type="text"
                          x-model="formData.settings.move_ops_file"
                          placeholder="/path/to/move_ops.txt"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Path to file containing move operations (one per line)</p>
                      </div>

                      <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Move Operations
                        </label>
                        <textarea
                          x-model="formData.settings.move_ops"
                          rows="4"
                          placeholder="title:dog:/home/videos/dogs&#10;title:cat:/home/videos/cats&#10;uploader:MyChannel:/home/videos/mychannel"
                          class="w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        ></textarea>
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                          Move operations (one per line). Format: <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">field:value:output_directory</code><br>
                          Example: <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">title:tutorial:/home/tutorials</code> (moves videos with "tutorial" in title to /home/tutorials after Metarr processing)
                        </p>
                      </div>

                      <div>
                        <label class="flex items-center cursor-pointer">
                          <input
                            type="checkbox"
                            x-model="formData.settings.use_global_cookies"
                            class="mr-2 rounded border-gray-300 text-brand-500 focus:ring-brand-500"
                          />
                          <span class="text-sm text-gray-700 dark:text-gray-300">Use Global Cookies (find cookies from all browsers)</span>
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- Metarr Settings Tab -->
                  <div x-show="activeTab === 'metarr'" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Output Directory
                        </label>
                        <input
                          type="text"
                          x-model="formData.metarr.metarr_output_directory"
                          placeholder="/output/here/after/metarr"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Output Extension
                        </label>
                        <select
                          x-model="formData.metarr.metarr_output_ext"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
                        >
                          <option value="">Same as input</option>
                          <option value="avi">avi</option>
                          <option value="flv">flv</option>
                          <option value="mkv">mkv</option>
                          <option value="mov">mov</option>
                          <option value="mp4">mp4</option>
                          <option value="webm">webm</option>
                        </select>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Rename Style
                        </label>
                        <select
                          x-model="formData.metarr.metarr_rename_style"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
                        >
                          <option value="">Skip</option>
                          <option value="spaces">Spaces</option>
                          <option value="underscores">Underscores</option>
                          <option value="fixes-only">Fixes Only</option>
                        </select>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Concurrency
                        </label>
                        <input
                          type="number"
                          x-model.number="formData.metarr.metarr_concurrency"
                          min="1"
                          placeholder="5"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          GPU Acceleration
                        </label>
                        <select
                          x-model="formData.metarr.metarr_gpu"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
                        >
                          <option value="">None</option>
                          <option value="auto">Auto</option>
                          <option value="nvidia">NVIDIA</option>
                          <option value="amd">AMD</option>
                          <option value="intel">Intel</option>
                          <option value="vaapi">VAAPI</option>
                        </select>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          GPU Directory
                        </label>
                        <input
                          type="text"
                          x-model="formData.metarr.metarr_gpu_directory"
                          placeholder="/dev/dri/renderD128"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Video Transcode Codecs
                        </label>
                        <textarea
                          x-model="formData.metarr.metarr_video_transcode_codecs"
                          placeholder="Leave empty for copy (no transcoding)"
                          rows="3"
                          class="w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 font-mono"
                        ></textarea>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                          One per line. Examples: <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">h264:hevc</code> (convert H.264 to HEVC),
                          <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">av1</code> (transcode to AV1), or leave empty to copy.
                        </p>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Audio Transcode Codecs
                        </label>
                        <textarea
                          x-model="formData.metarr.metarr_transcode_audio_codecs"
                          placeholder="Leave empty for copy (no transcoding)"
                          rows="3"
                          class="w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 font-mono"
                        ></textarea>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                          One per line. Examples: <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">dts:ac3</code> (convert DTS to AC3),
                          <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">aac</code> (transcode to AAC), or leave empty to copy.
                        </p>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Transcode Quality (CRF)
                        </label>
                        <input
                          type="number"
                          x-model.number="formData.metarr.metarr_transcode_quality"
                          min="0"
                          max="51"
                          placeholder="23"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Lower = better quality, 18-28 recommended</p>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Transcode Video Filter
                        </label>
                        <input
                          type="text"
                          x-model="formData.metarr.metarr_transcode_video_filter"
                          placeholder="e.g. scale=1920:1080"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">FFmpeg video filter string for transcoding</p>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Min Free Memory
                        </label>
                        <input
                          type="text"
                          x-model="formData.metarr.metarr_min_free_mem"
                          placeholder="2GB"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Max CPU Usage (%)
                        </label>
                        <input
                          type="number"
                          x-model.number="formData.metarr.metarr_max_cpu_usage"
                          min="0.00"
                          max="100.00"
                          placeholder="80.00"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Extra FFmpeg Args
                        </label>
                        <input
                          type="text"
                          x-model="formData.metarr.metarr_extra_ffmpeg_args"
                          placeholder="Additional FFmpeg arguments"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                      </div>

                      <!-- Meta Operations -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Meta Operations File
                        </label>
                        <input
                          type="text"
                          x-model="formData.metarr.metarr_meta_ops_file"
                          placeholder="/path/to/meta_ops.txt"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Path to file containing metadata operations</p>
                      </div>

                      <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Meta Operations
                        </label>
                        <textarea
                          x-model="formData.metarr.metarr_meta_ops"
                          rows="3"
                          placeholder="title:set:My Title&#10;artist:set:My Artist&#10;album:delete:"
                          class="w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 font-mono"
                        ></textarea>
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                          Metadata operations (one per line). Format: <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">field:operation:value</code>
                        </p>
                      </div>

                      <!-- Filtered Meta Operations -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Filtered Meta Operations File
                        </label>
                        <input
                          type="text"
                          x-model="formData.metarr.filtered_meta_ops_file"
                          placeholder="/path/to/filtered_meta_ops.txt"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Path to file containing filtered metadata operations</p>
                      </div>

                      <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Filtered Meta Operations
                        </label>
                        <textarea
                          x-model="formData.metarr.filtered_meta_ops"
                          rows="3"
                          placeholder="title:contains:cat|title:prefix:[CAT VIDEO]&#10;title:contains:dog|artist:set:Dog Channel"
                          class="w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 font-mono"
                        ></textarea>
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                          Filter rules with metadata operations. Format: <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">filter_rule|meta_operation</code>
                        </p>
                      </div>

                      <!-- Filename Operations -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Filename Operations File
                        </label>
                        <input
                          type="text"
                          x-model="formData.metarr.metarr_filename_ops_file"
                          placeholder="/path/to/filename_ops.txt"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Path to file containing filename operations</p>
                      </div>

                      <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Filename Operations
                        </label>
                        <textarea
                          x-model="formData.metarr.metarr_filename_ops"
                          rows="3"
                          placeholder="prefix:[VIDEOS] &#10;suffix: - Downloaded&#10;replace:_: "
                          class="w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 font-mono"
                        ></textarea>
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                          Filename operations (one per line). Format: <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">operation:value</code>
                        </p>
                      </div>

                      <!-- Filtered Filename Operations -->
                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Filtered Filename Operations File
                        </label>
                        <input
                          type="text"
                          x-model="formData.metarr.filtered_filename_ops_file"
                          placeholder="/path/to/filtered_filename_ops.txt"
                          class="w-full h-11 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                        />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Path to file containing filtered filename operations</p>
                      </div>

                      <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Filtered Filename Operations
                        </label>
                        <textarea
                          x-model="formData.metarr.filtered_filename_ops"
                          rows="3"
                          placeholder="title:contains:tutorial|prefix:[TUTORIAL] &#10;title:contains:review|prefix:[REVIEW] "
                          class="w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 font-mono"
                        ></textarea>
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                          Filter rules with filename operations. Format: <code class="bg-gray-100 dark:bg-gray-800 px-1 rounded">filter_rule|filename_operation</code>
                        </p>
                      </div>
                    </div>
                  </div>

                  <!-- Notifications Tab -->
                  <div x-show="activeTab === 'notifications'" class="space-y-4">
                    <div class="space-y-4">
                      <div class="text-sm text-gray-600 dark:text-gray-400 bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                        <p class="font-medium text-gray-900 dark:text-gray-100 mb-2">Notification Format:</p>
                        <ul class="list-disc list-inside space-y-1">
                          <li><code class="bg-white dark:bg-gray-800 px-2 py-0.5 rounded">Notify URL|Friendly Name</code> - Applies to all channel URLs</li>
                          <li><code class="bg-white dark:bg-gray-800 px-2 py-0.5 rounded">Channel URL|Notify URL|Friendly Name</code> - Applies only to specific channel URL</li>
                        </ul>
                        <p class="mt-2">Example: <code class="bg-white dark:bg-gray-800 px-2 py-0.5 rounded">http://plex:32400/library/sections/1/refresh?X-Plex-Token=abc|Plex Library Refresh</code></p>
                      </div>

                      <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                          Notification URLs
                        </label>
                        <textarea
                          x-model="formData.notifications"
                          rows="6"
                          placeholder="http://plex:32400/library/sections/1/refresh?X-Plex-Token=abc|Plex Library&#10;https://example.com/webhook|My Webhook&#10;https://tubesite.com/@channel|http://notify.com/hook|Tube Site Only"
                          class="w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 font-mono"
                        ></textarea>
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                          Enter one notification per line. These URLs will be called when new videos are downloaded.<br>
                          Use for Plex library refreshes, webhooks, or other notification services.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Form Actions -->
                <div class="flex items-center justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                  <a
                    href="index.html"
                    class="inline-flex items-center px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700"
                  >
                    Cancel
                  </a>
                  <button
                    type="submit"
                    :disabled="submitting"
                    class="inline-flex items-center px-4 py-2.5 text-sm font-medium text-white bg-brand-500 rounded-lg hover:bg-brand-600 focus:ring-3 focus:ring-brand-500/50 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    <span x-show="!submitting">Update Channel</span>
                    <span x-show="submitting">Updating...</span>
                  </button>
                </div>
                </div> <!-- End of form content x-show wrapper -->
              </form>
            </div>
            <!-- Form End -->
          </div>
        </main>
        <!-- ===== Main Content End ===== -->
      </div>
      <!-- ===== Content Area End ===== -->
    </div>
    <!-- ===== Page Wrapper End ===== -->

    <script defer src="bundle.js"></script>
    <script>
      function channelForm() {
        return {
          channelId: null,
          loading: true,
          formData: {
            name: '',
            ignore_run: false,
            notifications: '',
            urls: [],
            settings: {
              video_directory: '',
              json_directory: '',
              max_concurrency: 1,
              crawl_freq: 30,
              download_retries: 3,
              max_filesize: '',
              ytdlp_output_ext: '',
              cookies_from_browser: '',
              external_downloader: '',
              external_downloader_args: '',
              extra_ytdlp_video_args: '',
              extra_ytdlp_meta_args: '',
              use_global_cookies: false,
              channel_config_file: '',
              from_date: '',
              to_date: '',
              filter_file: '',
              filters: '',
              move_ops_file: '',
              move_ops: ''
            },
            metarr: {
              metarr_output_directory: '',
              metarr_output_ext: '',
              metarr_rename_style: '',
              metarr_concurrency: 3,
              metarr_max_cpu_usage: '',
              metarr_min_free_mem: '',
              metarr_gpu: '',
              metarr_gpu_directory: '',
              metarr_video_transcode_codecs: '',
              metarr_transcode_audio_codecs: '',
              metarr_transcode_quality: '',
              metarr_transcode_video_filter: '',
              metarr_extra_ffmpeg_args: '',
              metarr_filename_ops: '',
              metarr_filename_ops_file: '',
              filtered_filename_ops: '',
              filtered_filename_ops_file: '',
              metarr_meta_ops: '',
              metarr_meta_ops_file: '',
              filtered_meta_ops: '',
              filtered_meta_ops_file: ''
            }
          },
          error: '',
          success: '',
          submitting: false,

          async init() {
            // Get channel ID from URL query parameter
            const urlParams = new URLSearchParams(window.location.search);
            this.channelId = urlParams.get('id');

            if (!this.channelId) {
              this.error = 'No channel ID provided';
              this.loading = false;
              return;
            }

            // Fetch channel data
            await this.loadChannelData();
          },

          async loadChannelData() {
            try {
              const response = await fetch(`/api/v1/channels/${this.channelId}`);
              
              if (!response.ok) {
                if (response.status === 404) {
                  throw new Error('Channel not found');
                }
                throw new Error('Failed to load channel data');
              }

              const data = await response.json();
              this.populateFormData(data);
              this.loading = false;

            } catch (err) {
              this.error = err.message || 'An error occurred while loading the channel';
              this.loading = false;
              console.error('Error loading channel:', err);
            }
          },

          populateFormData(data) {
            // Populate basic info
            this.formData.name = data.name || '';
            this.formData.ignore_run = data.ignore_run === 'true' || data.ignore_run === true;
            
            // Populate notifications (convert from space-separated to newline-separated)
            if (data.notifications) {
              this.formData.notifications = Array.isArray(data.notifications) 
                ? data.notifications.join('\n')
                : data.notifications.split(' ').filter(n => n).join('\n');
            }

            // Populate URLs
            if (data.urls && data.urls.length > 0) {
              this.formData.urls = data.urls.map(url => {
                const urlEntry = {
                  url: url,
                  hasAuth: false,
                  username: '',
                  password: '',
                  loginURL: '',
                  hasCustomSettings: false,
                  custom: this.getEmptyCustomSettings()
                };

                // Check if this URL has auth details
                if (data.auth_details && Array.isArray(data.auth_details)) {
                  const authDetail = data.auth_details.find(auth => auth.channel_url === url);
                  if (authDetail) {
                    urlEntry.hasAuth = true;
                    urlEntry.username = authDetail.username || '';
                    urlEntry.password = authDetail.password || '';
                    urlEntry.loginURL = authDetail.login_url || '';
                  }
                }

                // Check if this URL has custom settings
                if (data.url_settings && data.url_settings[url]) {
                  urlEntry.hasCustomSettings = true;
                  const urlSettings = data.url_settings[url];
                  
                  // Populate custom settings
                  if (urlSettings.settings) {
                    Object.keys(urlSettings.settings).forEach(key => {
                      const value = urlSettings.settings[key];
                      if (value !== null && value !== undefined) {
                        urlEntry.custom[key] = value;
                      }
                    });
                  }

                  // Populate custom metarr settings
                  if (urlSettings.metarr) {
                    Object.keys(urlSettings.metarr).forEach(key => {
                      const value = urlSettings.metarr[key];
                      if (value !== null && value !== undefined) {
                        // Convert codec arrays to newline-separated strings
                        if ((key === 'metarr_video_transcode_codecs' || key === 'metarr_transcode_audio_codecs') && Array.isArray(value)) {
                          urlEntry.custom[key] = value.join('\n');
                        } else {
                          urlEntry.custom[key] = value;
                        }
                      }
                    });
                  }
                }

                return urlEntry;
              });
            }

            // Populate global settings
            if (data.settings) {
              Object.keys(data.settings).forEach(key => {
                const value = data.settings[key];
                if (value !== null && value !== undefined && this.formData.settings.hasOwnProperty(key)) {
                  if (key === 'use_global_cookies') {
                    this.formData.settings[key] = value === 'true' || value === true;
                  } else {
                    this.formData.settings[key] = value;
                  }
                }
              });
            }

            // Populate global metarr settings
            if (data.metarr) {
              Object.keys(data.metarr).forEach(key => {
                const value = data.metarr[key];
                if (value !== null && value !== undefined && this.formData.metarr.hasOwnProperty(key)) {
                  // Convert codec arrays to newline-separated strings
                  if ((key === 'metarr_video_transcode_codecs' || key === 'metarr_transcode_audio_codecs') && Array.isArray(value)) {
                    this.formData.metarr[key] = value.join('\n');
                  } else {
                    this.formData.metarr[key] = value;
                  }
                }
              });
            }
          },

          getEmptyCustomSettings() {
            return {
              video_directory: '',
              json_directory: '',
              max_concurrency: null,
              crawl_freq: null,
              download_retries: null,
              max_filesize: '',
              from_date: '',
              to_date: '',
              channel_config_file: '',
              filter_file: '',
              filters: '',
              ytdlp_output_ext: '',
              cookies_from_browser: '',
              external_downloader: '',
              external_downloader_args: '',
              extra_ytdlp_video_args: '',
              extra_ytdlp_meta_args: '',
              move_ops_file: '',
              move_ops: '',
              metarr_output_directory: '',
              metarr_output_ext: '',
              metarr_rename_style: '',
              metarr_concurrency: null,
              metarr_max_cpu_usage: null,
              metarr_min_free_mem: '',
              metarr_gpu: '',
              metarr_video_transcode_codecs: '',
              metarr_transcode_audio_codecs: '',
              metarr_transcode_quality: null,
              metarr_transcode_video_filter: '',
              metarr_extra_ffmpeg_args: '',
              metarr_meta_ops: '',
              metarr_filename_ops: '',
              filtered_meta_ops: '',
              filtered_filename_ops: ''
            };
          },

          addURL() {
            this.formData.urls.push({
              url: '',
              hasAuth: false,
              username: '',
              password: '',
              loginURL: '',
              hasCustomSettings: false,
              custom: this.getEmptyCustomSettings()
            });
          },

          removeURL(index) {
            if (this.formData.urls.length > 1) {
              this.formData.urls.splice(index, 1);
            }
          },

          async submitForm() {
            this.error = '';
            this.success = '';
            this.submitting = true;

            try {
              // Build the request payload matching the backend handler expectations
              const payload = {
                name: this.formData.name,
                urls: this.formData.urls.filter(u => u.url).map(u => u.url).join(' '),
                auth_details: this.buildAuthDetails(),
                ...this.formData.settings,
                ...this.formData.metarr
              };

              // Add notifications (split by newlines and filter empty)
              if (this.formData.notifications && this.formData.notifications.trim()) {
                payload.notifications = this.formData.notifications
                  .split('\n')
                  .map(n => n.trim())
                  .filter(n => n)
                  .join(' ');
              }

              // Build per-URL custom settings as JSON object
              const perURLSettings = this.buildPerURLSettingsJSON();
              if (Object.keys(perURLSettings).length > 0) {
                payload.url_settings = JSON.stringify(perURLSettings);
              }

              // Backend expects newline-separated operations to preserve values with spaces
              // No conversion needed - textareas already contain newline-separated values

              // Add ignore_run if checked (backend expects "true" string or absence)
              if (this.formData.ignore_run) {
                payload.ignore_run = 'true';
              }

              // Convert boolean to string for use_global_cookies
              if (this.formData.settings.use_global_cookies) {
                payload.use_global_cookies = 'true';
              } else {
                delete payload.use_global_cookies; // Remove false value
              }

              // Use PUT request to update endpoint
              const response = await fetch(`/api/v1/channels/${this.channelId}/update`, {
                method: 'PUT',
                headers: {
                  'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(payload)
              });

              if (!response.ok) {
                const errorText = await response.text();
                throw new Error(errorText || 'Failed to update channel');
              }

              this.success = 'Channel updated successfully!';

              // Redirect after a short delay
              setTimeout(() => {
                window.location.href = 'list-channels.html';
              }, 1500);

            } catch (err) {
              this.error = err.message || 'An error occurred while updating the channel';
              console.error('Error updating channel:', err);
            } finally {
              this.submitting = false;
            }
          },

          buildAuthDetails() {
            // Build auth_details array based on URLs with authentication
            const authEntries = [];
            this.formData.urls.forEach(urlEntry => {
              if (urlEntry.hasAuth && urlEntry.username && urlEntry.loginURL) {
                authEntries.push(JSON.stringify({
                  channel_url: urlEntry.url,
                  username: urlEntry.username,
                  password: urlEntry.password || '',
                  login_url: urlEntry.loginURL
                }));
              }
            });
            return authEntries.join(' ');
          },

          buildPerURLSettingsJSON() {
            // Build per-URL custom settings as structured JSON
            // Format: { "channel_url": { settings: {...}, metarr: {...} } }
            const perURL = {};

            this.formData.urls.forEach(urlEntry => {
              if (urlEntry.hasCustomSettings && urlEntry.url && urlEntry.custom) {
                const channelURL = urlEntry.url;
                const settings = {};
                const metarr = {};

                // Process basic/advanced settings
                const settingsFields = [
                  'video_directory', 'json_directory', 'max_concurrency', 'crawl_freq',
                  'download_retries', 'max_filesize', 'from_date', 'to_date',
                  'channel_config_file', 'filter_file', 'filters',
                  'ytdlp_output_ext', 'cookies_from_browser',
                  'external_downloader', 'external_downloader_args',
                  'extra_ytdlp_video_args', 'extra_ytdlp_meta_args',
                  'move_ops_file', 'move_ops'
                ];

                settingsFields.forEach(field => {
                  const value = urlEntry.custom[field];
                  if (value !== null && value !== undefined && value !== '') {
                    // Keep newlines for operations (filters, move_ops) to preserve values with spaces
                    if (typeof value === 'string' && value.includes('\n')) {
                      settings[field] = value.split('\n').map(v => v.trim()).filter(v => v).join('\n');
                    } else {
                      settings[field] = value;
                    }
                  }
                });

                // Process metarr settings
                const metarrFields = [
                  'metarr_output_directory', 'metarr_output_ext', 'metarr_rename_style',
                  'metarr_concurrency', 'metarr_max_cpu_usage', 'metarr_min_free_mem',
                  'metarr_gpu', 'metarr_video_transcode_codecs', 'metarr_transcode_audio_codecs',
                  'metarr_transcode_quality', 'metarr_transcode_video_filter',
                  'metarr_extra_ffmpeg_args', 'metarr_meta_ops', 'metarr_filename_ops',
                  'filtered_meta_ops', 'filtered_filename_ops'
                ];

                metarrFields.forEach(field => {
                  const value = urlEntry.custom[field];
                  if (value !== null && value !== undefined && value !== '') {
                    // Keep newlines for operations to preserve values with spaces
                    if (typeof value === 'string' && value.includes('\n')) {
                      metarr[field] = value.split('\n').map(v => v.trim()).filter(v => v).join('\n');
                    } else {
                      metarr[field] = value;
                    }
                  }
                });

                // Only add if there are overrides
                if (Object.keys(settings).length > 0 || Object.keys(metarr).length > 0) {
                  perURL[channelURL] = {};
                  if (Object.keys(settings).length > 0) perURL[channelURL].settings = settings;
                  if (Object.keys(metarr).length > 0) perURL[channelURL].metarr = metarr;
                }
              }
            });

            return perURL;
          }
        };
      }
    </script>
  </body>
</html>
